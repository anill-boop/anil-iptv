<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Anƒ±l IPTV</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg: #0f1419; --bg2: #1a1f2e; --bg3: #252b3a; --accent: #FFA500; --text: #ffffff; --text2: #a0a8b8; --border: #2d3548; }
        body { font-family: 'Segoe UI', Arial; background: var(--bg); color: var(--text); overflow: hidden; }
        .screen { width: 100vw; height: 100vh; position: absolute; top: 0; left: 0; }
        .hidden { display: none !important; }
        
        /* Y√úKLEME */ 
        .loading-wrapper { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; gap: 20px; }
        .fire-logo { width: 120px; height: 120px; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .loading-wrapper h1 { font-size: 42px; font-weight: 300; color: var(--text2); }
        .loading-wrapper strong { font-weight: 700; color: var(--text); }
        .dots { display: flex; gap: 10px; }
        .dots span { width: 12px; height: 12px; background: var(--accent); border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        .dots span:nth-child(1) { animation-delay: -0.32s; }
        .dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); opacity: 0.5; } 40% { transform: scale(1); opacity: 1; } }
        .mac-info { position: absolute; bottom: 30px; font-size: 14px; background: var(--bg2); padding: 10px 20px; border-radius: 8px; border: 1px solid var(--border); }
        
        /* ANA SAYFA */
        .home-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 40px; background: var(--bg2); border-bottom: 2px solid var(--border); }
        .logo { display: flex; align-items: center; gap: 12px; font-size: 24px; font-weight: 300; }
        .logo svg { width: 35px; height: 35px; }
        .logo strong { font-weight: 700; }
        .playlist-status { padding: 15px 40px; background: var(--bg2); display: flex; justify-content: space-between; align-items: center; font-size: 14px; }
        .playlist-status strong { color: var(--accent); }
        .active { color: #4CAF50; }
        .cards-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px; padding: 60px 80px; max-width: 1400px; margin: 0 auto; }
        .card { background: var(--bg2); border: 2px solid var(--border); border-radius: 20px; padding: 40px 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px; cursor: pointer; transition: all 0.3s ease; aspect-ratio: 1; }
        .card:hover { border-color: var(--accent); background: var(--bg3); transform: translateY(-8px); box-shadow: 0 10px 30px rgba(255, 165, 0, 0.3); }
        .card svg { width: 80px; height: 80px; color: var(--text); }
        .card span { font-size: 20px; font-weight: 500; }
        
        /* 2 PANEL */
        .two-panel { display: grid; grid-template-columns: 250px 1fr; height: 100vh; }
        .left-panel { background: var(--bg2); border-right: 2px solid var(--border); display: flex; flex-direction: column; }
        .left-header { padding: 15px; border-bottom: 2px solid var(--border); }
        .left-header button { width: 100%; background: var(--bg3); border: 1px solid var(--border); color: var(--text); padding: 12px; border-radius: 8px; cursor: pointer; font-size: 16px; }
        .categories-list { flex: 1; overflow-y: auto; padding: 10px; }
        .category-item { padding: 15px; margin: 5px 0; background: var(--bg3); border: 2px solid transparent; border-radius: 8px; cursor: pointer; transition: all 0.3s; font-size: 14px; }
        .category-item:hover { border-color: var(--accent); }
        .category-item.active { background: var(--accent); color: #000; font-weight: 600; }
        .cat-count { float: right; opacity: 0.7; }
        
        .right-panel { display: flex; flex-direction: column; }
        .right-header { padding: 20px 30px; background: var(--bg2); border-bottom: 2px solid var(--border); }
        .right-header h2 { color: var(--accent); }
        .channels-container { flex: 1; overflow-y: auto; padding: 20px; }
        .channel-item { background: var(--bg2); border: 2px solid var(--border); border-radius: 10px; padding: 15px; margin: 10px 0; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 15px; }
        .channel-item:hover { border-color: var(--accent); background: var(--bg3); transform: translateX(10px); }
        .channel-logo { width: 70px; height: 50px; object-fit: contain; background: var(--bg); border-radius: 8px; padding: 5px; }
        .channel-info { flex: 1; }
        .channel-name { font-size: 18px; font-weight: 600; margin-bottom: 5px; }
        .channel-group { font-size: 13px; color: var(--text2); }
        
        /* OYNATICI */
        .player-screen { display: flex; flex-direction: column; }
        .player-video { width: 100%; height: calc(100vh - 150px); background: #000; }
        .player-controls { background: var(--bg2); padding: 20px 30px; border-top: 2px solid var(--border); }
        .player-info { margin-bottom: 15px; }
        .player-title { font-size: 24px; font-weight: 600; margin-bottom: 5px; }
        .player-category { font-size: 14px; color: var(--text2); }
        .control-buttons { display: flex; gap: 15px; justify-content: center; }
        .control-buttons button { background: var(--accent); border: none; color: #000; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; }
        
        .bottom-bar { display: flex; justify-content: center; gap: 15px; padding: 20px 40px; background: var(--bg2); border-top: 1px solid var(--border); }
        .bottom-bar button { background: var(--bg3); border: 1px solid var(--border); color: var(--text); padding: 10px 20px; border-radius: 8px; cursor: pointer; }
        footer { position: absolute; bottom: 0; width: 100%; text-align: center; padding: 15px; font-size: 12px; color: var(--text2); background: var(--bg); }
        
        /* MODAL */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .mbox { background: var(--bg2); border-radius: 15px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative; }
        .mclose { position: absolute; top: 15px; right: 15px; background: var(--bg3); border: none; color: var(--text); width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 20px; }
        .msection { margin: 20px 0; }
        .msection h3 { margin-bottom: 15px; color: var(--accent); }
        .minput { display: flex; gap: 10px; margin-top: 10px; }
        .minput input { flex: 1; background: var(--bg3); border: 1px solid var(--border); color: var(--text); padding: 10px; border-radius: 6px; }
        .btn-primary { background: var(--accent); border: none; color: #000; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .danger { background: #f44336 !important; color: #fff !important; }
        .playlist-item { padding: 10px; background: var(--bg3); margin: 5px 0; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; }
        .playlist-item button { margin-left: 5px; padding: 5px 15px; border: none; border-radius: 4px; cursor: pointer; }
        
        /* QR */
        .qr-section { background: var(--bg3); border: 2px solid var(--accent); border-radius: 12px; padding: 20px; text-align: center; }
        .qr-code { background: white; padding: 15px; border-radius: 10px; display: inline-block; margin: 15px 0; }
        .qr-pin { font-size: 42px; font-weight: 700; color: var(--accent); letter-spacing: 8px; margin: 15px 0; }
        .qr-url { background: var(--bg2); padding: 10px; border-radius: 8px; font-family: monospace; font-size: 11px; color: var(--accent); word-break: break-all; }
    </style>
</head>
<body>
    <!-- Y√úKLEME -->
    <div id="loadingScreen" class="screen">
        <div class="loading-wrapper">
            <svg class="fire-logo" viewBox="0 0 60 60">
                <defs><linearGradient id="fire" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#FFA500"/><stop offset="100%" stop-color="#FF4500"/></linearGradient></defs>
                <path d="M30 10 C25 15, 20 20, 20 30 C20 38, 24 48, 30 48 C36 48, 40 38, 40 30 C40 20, 35 15, 30 10 Z M30 42 C27 42, 25 38, 25 34 C25 29, 28 25, 30 22 C32 25, 35 29, 35 34 C35 38, 33 42, 30 42 Z" fill="url(#fire)"/>
            </svg>
            <h1>Anƒ±l <strong>IPTV</strong></h1>
            <div class="dots"><span></span><span></span><span></span></div>
            <p>Y√ºkleniyor...</p>
            <div class="mac-info">MAC: <span id="loadMAC">--:--:--:--:--:--</span></div>
        </div>
    </div>

    <!-- ANA SAYFA -->
    <div id="homeScreen" class="screen hidden">
        <header class="home-header">
            <div class="logo">
                <svg viewBox="0 0 30 30"><path d="M15 3 C12 6, 10 9, 10 14 C10 18, 12 24, 15 24 C18 24, 20 18, 20 14 C20 9, 18 6, 15 3 Z M15 21 C14 21, 13 19, 13 17 C13 14, 14 12, 15 10 C16 12, 17 14, 17 17 C17 19, 16 21, 15 21 Z" fill="#FFA500"/></svg>
                <span>Anƒ±l <strong>IPTV</strong></span>
            </div>
            <span style="font-size: 12px; color: var(--text2);">v1.0</span>
        </header>
        <div class="playlist-status">
            <div>‚ò∞ Aktif Liste: <strong id="homePlaylist">-</strong></div>
            <div><span class="active">‚äô Aktif</span></div>
        </div>
        <div class="cards-grid">
            <div class="card" data-type="live">
                <svg viewBox="0 0 80 80"><rect x="15" y="20" width="50" height="35" rx="3" stroke="currentColor" stroke-width="3" fill="none"/><circle cx="40" cy="37" r="5" fill="currentColor"/></svg>
                <span>Canlƒ± TV</span>
            </div>
            <div class="card" data-type="movie">
                <svg viewBox="0 0 80 80"><rect x="15" y="25" width="50" height="35" rx="2" stroke="currentColor" stroke-width="3" fill="none"/><line x1="15" y1="32" x2="65" y2="32" stroke="currentColor" stroke-width="3"/></svg>
                <span>Filmler</span>
            </div>
            <div class="card" data-type="series">
                <svg viewBox="0 0 80 80"><rect x="20" y="20" width="40" height="40" rx="2" stroke="currentColor" stroke-width="3" fill="none"/><line x1="20" y1="30" x2="60" y2="30" stroke="currentColor" stroke-width="3"/></svg>
                <span>Diziler</span>
            </div>
            <div class="card" data-type="radio">
                <svg viewBox="0 0 80 80"><circle cx="40" cy="40" r="6" fill="currentColor"/><path d="M28 40 Q28 28, 40 28 Q52 28, 52 40" stroke="currentColor" stroke-width="3" fill="none"/></svg>
                <span>Radyo</span>
            </div>
        </div>
        <div class="bottom-bar">
            <button id="settings">‚öôÔ∏è Ayarlar</button>
            <button id="refresh">üîÑ Yenile</button>
        </div>
        <footer>
            <div>MAC: <span id="homeMAC">--:--:--:--:--:--</span></div>
            <div>Anƒ±l IPTV - Medya Oynatƒ±cƒ±</div>
        </footer>
    </div>

    <!-- KATEGORƒ∞ -->
    <div id="categoryScreen" class="screen hidden">
        <div class="two-panel">
            <div class="left-panel">
                <div class="left-header">
                    <button id="backToHome">‚óÄ Ana Sayfa</button>
                </div>
                <div class="categories-list" id="categoriesList"></div>
            </div>
            <div class="right-panel">
                <div class="right-header">
                    <h2 id="categoryTitle">Kanallar</h2>
                </div>
                <div class="channels-container" id="channelsContainer"></div>
            </div>
        </div>
    </div>

    <!-- OYNATICI -->
    <div id="playerScreen" class="screen hidden">
        <div class="player-screen">
            <video id="videoPlayer" class="player-video" controls></video>
            <div class="player-controls">
                <div class="player-info">
                    <div class="player-title" id="playerTitle">-</div>
                    <div class="player-category" id="playerCategory">-</div>
                </div>
                <div class="control-buttons">
                    <button id="playerBack">‚óÄ Geri</button>
                    <button id="playerPlay">‚ñ∂ Oynat</button>
                    <button id="playerStop">‚èπ Durdur</button>
                </div>
            </div>
        </div>
    </div>

    <!-- AYARLAR -->
    <div id="modal" class="modal hidden">
        <div class="mbox">
            <button class="mclose" id="mclose">‚úï</button>
            <h2>‚öôÔ∏è Ayarlar</h2>
            
            <div class="msection">
                <div class="qr-section">
                    <h3>üì± QR ile Ekle</h3>
                    <p style="font-size: 13px; color: var(--text2); margin-bottom: 10px;">
                        Cepten QR okut ‚Üí URL gir ‚Üí Otomatik eklensin
                    </p>
                    <div class="qr-code" id="qrCode"></div>
                    <div class="qr-pin" id="qrPin">----</div>
                    <div class="qr-url" id="qrUrl">Y√ºkleniyor...</div>
                </div>
            </div>
            
            <div class="msection">
                <h3>Kayƒ±tlƒ± Playlist'ler</h3>
                <div id="playlists"></div>
            </div>
            <div class="msection">
                <h3>Yeni Playlist</h3>
                <div class="minput">
                    <input type="text" id="pname" placeholder="Playlist Adƒ±">
                    <input type="text" id="purl" placeholder="M3U URL">
                    <button id="padd" class="btn-primary">Ekle</button>
                </div>
            </div>
            <div class="msection">
                <button id="clear" class="btn-primary danger">T√ºm√ºn√º Temizle</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script>
        const DEFAULT_LOGO = 'data:image/svg+xml,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 50"><defs><linearGradient id="g" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#FFA500"/><stop offset="100%" stop-color="#FF4500"/></linearGradient></defs><rect fill="#1a1f2e" width="70" height="50" rx="5"/><path d="M35 12 C32 15, 30 18, 30 23 C30 27, 32 33, 35 33 C38 33, 40 27, 40 23 C40 18, 38 15, 35 12 Z M35 30 C34 30, 33 28, 33 26 C33 23, 34 21, 35 19 C36 21, 37 23, 37 26 C37 28, 36 30, 35 30 Z" fill="url(#g)"/></svg>');
        
        let channels = [], currentPlaylist = null, currentType = null, loadIndex = 0, controlPin = '', checkInterval = null;
        const BATCH_SIZE = 20;
        
        function generateMAC() {
            const saved = localStorage.getItem('macAddress');
            if (saved) return saved;
            const mac = Array.from({length: 6}, () => Math.floor(Math.random() * 256).toString(16).padStart(2, '0')).join(':');
            localStorage.setItem('macAddress', mac);
            return mac;
        }
        const macAddress = generateMAC();
        document.getElementById('loadMAC').textContent = macAddress;
        document.getElementById('homeMAC').textContent = macAddress;
        
        async function parseM3U(url) {
            const response = await fetch(url);
            const text = await response.text();
            const lines = text.split('\n');
            const parsed = [];
            let current = null;
            
            for (let line of lines) {
                line = line.trim();
                if (line.startsWith('#EXTINF:')) {
                    current = { name: '', logo: '', group: 'Diƒüer', url: '', type: 'live' };
                    const nameMatch = line.match(/,(.+)$/);
                    if (nameMatch) current.name = nameMatch[1].trim();
                    const logoMatch = line.match(/tvg-logo="([^"]+)"/);
                    if (logoMatch) current.logo = logoMatch[1];
                    const groupMatch = line.match(/group-title="([^"]+)"/);
                    if (groupMatch) current.group = groupMatch[1];
                    
                    const g = current.group.toLowerCase(), n = current.name.toLowerCase();
                    if (g.includes('film') || g.includes('movie') || n.includes('film')) current.type = 'movie';
                    else if (g.includes('dizi') || g.includes('series') || g.includes('sezon')) current.type = 'series';
                    else if (g.includes('radyo') || g.includes('radio')) current.type = 'radio';
                    else current.type = 'live';
                } else if (line && !line.startsWith('#') && current) {
                    current.url = line;
                    current.id = 'ch_' + Date.now() + '_' + Math.random();
                    parsed.push(current);
                    current = null;
                }
            }
            return parsed;
        }
        
        async function loadPlaylist(pl) {
            document.getElementById('loadingScreen').classList.remove('hidden');
            try {
                channels = await parseM3U(pl.url);
                currentPlaylist = pl;
                localStorage.setItem('currentPlaylist', pl.id);
                document.getElementById('homePlaylist').textContent = pl.name;
                alert(`‚úÖ ${channels.length} kanal y√ºklendi!`);
            } catch (e) {
                alert('‚ùå Playlist y√ºklenemedi');
            }
            document.getElementById('loadingScreen').classList.add('hidden');
        }
        
        function sortCategories(cats) {
            return cats.sort((a, b) => {
                const yA = a.match(/\d{4}/), yB = b.match(/\d{4}/);
                if (yA && yB) return parseInt(yB[0]) - parseInt(yA[0]);
                else if (yA) return -1;
                else if (yB) return 1;
                else return a.localeCompare(b, 'tr');
            });
        }
        
        function showCategoryScreen(type) {
            if (channels.length === 0) { alert('√ñnce playlist ekleyin!'); return; }
            currentType = type;
            const filtered = channels.filter(ch => ch.type === type);
            if (filtered.length === 0) { alert('Bu kategoride i√ßerik yok!'); return; }
            
            const groups = {};
            filtered.forEach(ch => {
                if (!groups[ch.group]) groups[ch.group] = [];
                groups[ch.group].push(ch);
            });
            
            const catList = document.getElementById('categoriesList');
            catList.innerHTML = '';
            const sorted = sortCategories(Object.keys(groups));
            
            sorted.forEach((group, idx) => {
                const div = document.createElement('div');
                div.className = 'category-item' + (idx === 0 ? ' active' : '');
                div.innerHTML = `${group} <span class="cat-count">${groups[group].length}</span>`;
                div.onclick = () => {
                    document.querySelectorAll('.category-item').forEach(el => el.classList.remove('active'));
                    div.classList.add('active');
                    showChannels(groups[group]);
                };
                catList.appendChild(div);
            });
            
            showChannels(groups[sorted[0]]);
            const typeNames = { 'live': 'Canlƒ± TV', 'movie': 'Filmler', 'series': 'Diziler', 'radio': 'Radyo' };
            document.getElementById('categoryTitle').textContent = typeNames[type];
            document.getElementById('homeScreen').classList.add('hidden');
            document.getElementById('categoryScreen').classList.remove('hidden');
        }
        
        function showChannels(channelList) {
            const container = document.getElementById('channelsContainer');
            container.innerHTML = '';
            loadIndex = 0;
            
            const loadMore = () => {
                const end = Math.min(loadIndex + BATCH_SIZE, channelList.length);
                for (let i = loadIndex; i < end; i++) {
                    const ch = channelList[i];
                    const div = document.createElement('div');
                    div.className = 'channel-item';
                    div.innerHTML = `
                        <img class="channel-logo" src="${ch.logo || DEFAULT_LOGO}" onerror="this.src='${DEFAULT_LOGO}'">
                        <div class="channel-info">
                            <div class="channel-name">${ch.name}</div>
                            <div class="channel-group">${ch.group}</div>
                        </div>
                    `;
                    div.onclick = () => playChannel(ch);
                    container.appendChild(div);
                }
                loadIndex = end;
            };
            loadMore();
            container.onscroll = () => {
                if (container.scrollTop + container.clientHeight >= container.scrollHeight - 100 && loadIndex < channelList.length) loadMore();
            };
        }
        
        function playChannel(ch) {
            const video = document.getElementById('videoPlayer');
            video.pause();
            video.src = '';
            
            document.getElementById('playerTitle').textContent = ch.name;
            document.getElementById('playerCategory').textContent = ch.group;
            document.getElementById('categoryScreen').classList.add('hidden');
            document.getElementById('playerScreen').classList.remove('hidden');
            
            video.src = ch.url;
            video.load();
            video.addEventListener('loadedmetadata', function onLoaded() {
                video.play().then(() => {
                    document.getElementById('playerPlay').textContent = '‚è∏ Duraklat';
                }).catch(() => alert('Video oynatƒ±lamadƒ±. Tekrar deneyin.'));
                video.removeEventListener('loadedmetadata', onLoaded);
            }, { once: true });
        }
        
        function generatePin() {
            return Math.floor(1000 + Math.random() * 9000).toString();
        }
        
        function generateQR() {
            controlPin = generatePin();
            document.getElementById('qrPin').textContent = controlPin;
            const qrUrl = `https://KULLANICI.github.io/anil-iptv?pin=${controlPin}`;
            document.getElementById('qrUrl').textContent = qrUrl;
            
            const qrContainer = document.getElementById('qrCode');
            qrContainer.innerHTML = '';
            new QRCode(qrContainer, { text: qrUrl, width: 180, height: 180 });
            startPinCheck();
        }
        
        function startPinCheck() {
            if (checkInterval) clearInterval(checkInterval);
            checkInterval = setInterval(() => {
                const data = localStorage.getItem(`remote_${controlPin}`);
                if (data) {
                    const { name, url } = JSON.parse(data);
                    addPlaylistAuto(name, url);
                    localStorage.removeItem(`remote_${controlPin}`);
                    clearInterval(checkInterval);
                }
            }, 3000);
        }
        
        function addPlaylistAuto(name, url) {
            const playlists = JSON.parse(localStorage.getItem('playlists') || '[]');
            const newPl = { id: 'pl_' + Date.now(), name: name, url: url };
            playlists.push(newPl);
            localStorage.setItem('playlists', JSON.stringify(playlists));
            alert(`‚úÖ QR ile eklendi: ${name}`);
            renderPlaylists();
            loadPlaylist(newPl);
        }
        
        setTimeout(() => {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('homeScreen').classList.remove('hidden');
            
            const currentId = localStorage.getItem('currentPlaylist');
            if (currentId) {
                const playlists = JSON.parse(localStorage.getItem('playlists') || '[]');
                const pl = playlists.find(p => p.id === currentId);
                if (pl) {
                    document.getElementById('homePlaylist').textContent = pl.name;
                    loadPlaylist(pl);
                }
            }
        }, 2000);
        
        document.querySelectorAll('.card').forEach(card => {
            card.onclick = () => showCategoryScreen(card.dataset.type);
        });
        
        document.getElementById('settings').onclick = () => {
            document.getElementById('modal').classList.remove('hidden');
            renderPlaylists();
            generateQR();
        };
        
        document.getElementById('mclose').onclick = () => {
            document.getElementById('modal').classList.add('hidden');
            if (checkInterval) clearInterval(checkInterval);
        };
        
        document.getElementById('refresh').onclick = () => location.reload();
        document.getElementById('backToHome').onclick = () => {
            document.getElementById('categoryScreen').classList.add('hidden');
            document.getElementById('homeScreen').classList.remove('hidden');
        };
        
        document.getElementById('playerBack').onclick = () => {
            const video = document.getElementById('videoPlayer');
            video.pause();
            video.src = '';
            document.getElementById('playerScreen').classList.add('hidden');
            document.getElementById('categoryScreen').classList.remove('hidden');
        };
        
        document.getElementById('playerPlay').onclick = () => {
            const video = document.getElementById('videoPlayer');
            if (video.paused) {
                video.play().then(() => {
                    document.getElementById('playerPlay').textContent = '‚è∏ Duraklat';
                }).catch(() => alert('Oynatma hatasƒ±'));
            } else {
                video.pause();
                document.getElementById('playerPlay').textContent = '‚ñ∂ Oynat';
            }
        };
        
        document.getElementById('playerStop').onclick = () => {
            const video = document.getElementById('videoPlayer');
            video.pause();
            video.currentTime = 0;
        };
        
        function renderPlaylists() {
            const container = document.getElementById('playlists');
            const playlists = JSON.parse(localStorage.getItem('playlists') || '[]');
            const currentId = localStorage.getItem('currentPlaylist');
            
            container.innerHTML = playlists.length === 0 ? '<p style="color: var(--text2); text-align: center;">Hen√ºz playlist eklemediniz</p>' : '';
            
            playlists.forEach(p => {
                const div = document.createElement('div');
                div.className = 'playlist-item';
                const isActive = p.id === currentId;
                div.innerHTML = `
                    <strong style="${isActive ? 'color: var(--accent);' : ''}">${isActive ? '‚úì ' : ''}${p.name}</strong>
                    <div>
                        ${!isActive ? `<button onclick="selectPlaylist('${p.id}')" class="btn-primary">Se√ß</button>` : ''}
                        <button onclick="deletePlaylist('${p.id}')" class="danger">Sil</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }
        
        document.getElementById('padd').onclick = () => {
            const name = document.getElementById('pname').value.trim();
            const url = document.getElementById('purl').value.trim();
            
            if (!name || !url) { alert('ƒ∞sim ve URL gerekli!'); return; }
            
            const playlists = JSON.parse(localStorage.getItem('playlists') || '[]');
            const newPl = { id: 'pl_' + Date.now(), name: name, url: url };
            playlists.push(newPl);
            localStorage.setItem('playlists', JSON.stringify(playlists));
            
            alert('‚úÖ Playlist eklendi!');
            renderPlaylists();
            loadPlaylist(newPl);
            
            document.getElementById('pname').value = '';
            document.getElementById('purl').value = '';
        };
        
        window.selectPlaylist = function(id) {
            const playlists = JSON.parse(localStorage.getItem('playlists') || '[]');
            const pl = playlists.find(p => p.id === id);
            if (pl) {
                loadPlaylist(pl);
                renderPlaylists();
            }
        };
        
        window.deletePlaylist = function(id) {
            if (!confirm('Silmek istediƒüinize emin misiniz?')) return;
            let playlists = JSON.parse(localStorage.getItem('playlists') || '[]');
            playlists = playlists.filter(p => p.id !== id);
            localStorage.setItem('playlists', JSON.stringify(playlists));
            
            if (localStorage.getItem('currentPlaylist') === id) {
                localStorage.removeItem('currentPlaylist');
                document.getElementById('homePlaylist').textContent = '-';
                channels = [];
            }
            
            alert('‚úÖ Silindi!');
            renderPlaylists();
        };
        
        document.getElementById('clear').onclick = () => {
            if (!confirm('T√úM VERƒ∞LER Sƒ∞Lƒ∞NECEK! Emin misiniz?')) return;
            localStorage.clear();
            location.reload();
        };
        
        if (typeof tizen !== 'undefined') {
            window.addEventListener('tizenhwkey', (e) => {
                if (e.keyName === 'back') {
                    const modal = document.getElementById('modal');
                    const playerScreen = document.getElementById('playerScreen');
                    const categoryScreen = document.getElementById('categoryScreen');
                    
                    if (!modal.classList.contains('hidden')) {
                        modal.classList.add('hidden');
                        if (checkInterval) clearInterval(checkInterval);
                    } else if (!playerScreen.classList.contains('hidden')) {
                        document.getElementById('playerBack').click();
                    } else if (!categoryScreen.classList.contains('hidden')) {
                        document.getElementById('backToHome').click();
                    } else {
                        tizen.application.getCurrentApplication().exit();
                    }
                }
            });
        }
    </script>
</body>
</html>